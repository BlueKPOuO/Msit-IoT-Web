@using ECPay.Payment.Integration;
@model IEnumerable<IoTWeb.Models.ManagementFee>

@{
                ViewBag.Title = "Index";
    Layout = "~/Views/Shared/_Layout.cshtml";
}

@section styles
    {
    <link href="~/lib/font-awesome/css/font-awesome.min.css" rel="stylesheet">
}

<div class="col-lg-8 col-lg-offset-2" style="margin-top:10px">
    <div id="2m">
        <div style="background-color:#eadb93;font-size:36px;font-weight:600">
            <i class="fa fa-users" aria-hidden="true" style="margin:5px"></i>
            當期管理費
        </div>
    </div>
    <div id="more">
        <div style="background-color:orange;font-size:36px;font-weight:600">
            <i class="fa fa-exclamation-triangle" aria-hidden="true" style="margin:5px"></i>
            逾期未繳交之管理費 請儘速繳交！
        </div>
    </div>
</div>

@section scripts
    {
    <script>
        $(document).ready(
                    @{ 
                    AllInOne oPayment = new AllInOne();
                    /* 服務參數 */
                    oPayment.ServiceMethod = HttpMethod.HttpPOST;//介接服務時，呼叫 API 的方法
                    oPayment.ServiceURL = "https://payment-stage.ecpay.com.tw/Cashier/AioCheckOut/V5";//要呼叫介接服務的網址
                    oPayment.HashKey = "5294y06JbISpM5x9";//ECPay提供的Hash Key
                    oPayment.HashIV = "v77hoKGq4kWxNNIS";//ECPay提供的Hash IV
                    oPayment.MerchantID = "2000132";//ECPay提供的特店編號

                    /* 基本參數 */
                    oPayment.Send.ReturnURL = "http://example.com";//付款完成通知回傳的網址
                    oPayment.Send.ClientBackURL = "http://www.ecpay.com.tw/";//瀏覽器端返回的廠商網址
                    oPayment.Send.OrderResultURL = "http://localhost:52413/CheckOutFeedback.aspx";//瀏覽器端回傳付款結果網址
                    oPayment.Send.MerchantTradeNo = "ECPay" + new Random().Next(0, 99999).ToString();//廠商的交易編號
                    oPayment.Send.MerchantTradeDate = DateTime.Now;//廠商的交易時間
                    oPayment.Send.TotalAmount = Decimal.Parse(1000.ToString());//交易總金額
                    oPayment.Send.TradeDesc = "交易描述";//交易描述
                    oPayment.Send.ChoosePayment = PaymentMethod.Credit;//使用的付款方式
                    oPayment.Send.Remark = "";//備註欄位
                    oPayment.Send.ChooseSubPayment = PaymentMethodItem.None;//使用的付款子項目
                    oPayment.Send.NeedExtraPaidInfo = ExtraPaymentInfo.Yes;//是否需要額外的付款資訊
                    oPayment.Send.DeviceSource = DeviceType.PC;//來源裝置
                    oPayment.Send.IgnorePayment = ""; //不顯示的付款方式
                    oPayment.Send.PlatformID = "";//特約合作平台商代號
                    oPayment.Send.CustomField1 = "";
                    oPayment.Send.CustomField2 = "";
                    oPayment.Send.CustomField3 = "";
                    oPayment.Send.CustomField4 = "";
                    oPayment.Send.EncryptType = 1;

                    //訂單的商品資料
                    oPayment.Send.Items.Add(new Item()
                    {
                        Name = "管理費",//商品名稱
                        Price = Decimal.Parse(1000.ToString()),//商品單價
                        Currency = "新台幣",//幣別單位
                        Quantity = Int32.Parse("1"),//購買數量
                    });

                    /* 產生訂單 */
                    oPayment.CheckOut();
                    }




            @*$.getJSON('@Url.Action("GetFee", "ManagementFees", new { Area = "Client" })')
                .done(function (datas) {
                    console.log(datas);
                    var d = new Date();
                    var m = d.getMonth() + 1;
                    var mTitle = document.getElementById('modalLabelSmall');
                    $.each(datas, function (i, model) {
                        if (Math.abs(m - model.Month) < 1) {
                            $("#2m").append(`<div style="height:50px;border:1px solid black; margin:10px 0px;">
                                                 <div class="col-sm-10" style="font-size:24px;line-height:normal;">
                                                ${model.Year}年度${model.Month}月份管理費－新臺幣${model.Fee}元
                                                </div>
                                               <div class="col-sm-2"> 
                                                     <button class="pay btn btn-primary">繳費</button> 
                                               </div> 
                                            </div>`)
                        }
                        else {
                            $("#more").append(`<div style="height:50px;border:1px solid black; margin:10px 0px;">
                                                 <div class="col-sm-10" style="font-size:24px;line-height:normal;">
                                                ${model.Year}年度${model.Month}月份管理費－新臺幣${model.Fee}元
                                                </div>
                                                <div class="col-sm-2"> 
                                                     <button class="pay btn btn-warning">繳費</button> 
                                                </div> 
                                            </div>`)
                        }
                    })
                }*@
        )
    </script>
}